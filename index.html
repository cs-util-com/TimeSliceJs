<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FFmpeg.wasm Single-Threaded Self-Hosted Example</title>
</head>
<body>
  <p id="status">Loading FFmpeg...</p>
  
  <!-- Load FFmpeg API from local files -->
  <script src="./ffmpeg-core/ffmpeg.js"></script>
  <script src="./ffmpeg-core/814.ffmpeg.js"></script>
  <script>
    (async () => {
      try {
        // Log more detailed information about FFmpegWASM
        console.log("FFmpegWASM type:", typeof FFmpegWASM);
        console.log("FFmpegWASM keys:", Object.keys(FFmpegWASM));
        console.log("FFmpegWASM prototype:", Object.getPrototypeOf(FFmpegWASM));
        console.log("FFmpegWASM properties:", Object.getOwnPropertyNames(FFmpegWASM));
        
        // Try to create FFmpeg instance based on what's available
        let ffmpeg;
        
        // Check if FFmpegWASM is a constructor itself
        if (typeof FFmpegWASM === 'function') {
          ffmpeg = new FFmpegWASM({
            log: true,
            corePath: './ffmpeg-core/ffmpeg-core.js',
            mainName: 'main',
            workerPath: 'data:application/javascript;base64,' + btoa('console.log("Dummy worker loaded.");')
          });
        } 
        // Check if it's directly callable as a factory function
        else if (typeof FFmpegWASM === 'object') {
          // Try using the createFFmpeg function directly
          const options = {
            log: true,
            corePath: './ffmpeg-core/ffmpeg-core.js',
            mainName: 'main',
            workerPath: 'data:application/javascript;base64,' + btoa('console.log("Dummy worker loaded.");')
          };
          
          // Access prototype method if it exists
          if (typeof FFmpegWASM.__proto__ === 'object' && typeof FFmpegWASM.__proto__.createFFmpeg === 'function') {
            ffmpeg = FFmpegWASM.__proto__.createFFmpeg(options);
          } else {
            // Final fallback - access it through window global
            ffmpeg = window.createFFmpeg ? window.createFFmpeg(options) : null;
          }
        }
        
        if (!ffmpeg) {
          throw new Error("Could not initialize FFmpeg - no valid constructor or factory method found");
        }

        await ffmpeg.load();
        document.getElementById('status').textContent = 'FFmpeg loaded successfully.';
        console.log("FFmpeg loaded successfully!");
      } catch (err) {
        console.error('Error loading FFmpeg:', err);
        document.getElementById('status').textContent = `Error loading FFmpeg: ${err}`;
      }
    })();
  </script>
</body>
</html>